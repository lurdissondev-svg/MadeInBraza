services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: braza-backend
    restart: unless-stopped
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://lurdisson:Pandorinha123%40%23@postgres:5432/braza?connection_limit=5
      JWT_SECRET: ${JWT_SECRET}
      PORT: 3000
      FIREBASE_PROJECT_ID: ${FIREBASE_PROJECT_ID}
      FIREBASE_PRIVATE_KEY: ${FIREBASE_PRIVATE_KEY}
      FIREBASE_CLIENT_EMAIL: ${FIREBASE_CLIENT_EMAIL}
      ENCRYPTION_KEY: ${ENCRYPTION_KEY}
      # UAZAPI WhatsApp Integration
      UAZAPI_URL: https://lucas.uazapi.com
      UAZAPI_TOKEN: cf359d24-11a3-486f-b995-975a29d09662
      UAZAPI_AVISOS_GROUP_ID: 120363247580405853@g.us
      BASE_URL: https://braza.lurdisson.com.br
      # Nginx Proxy
      VIRTUAL_HOST: braza.lurdisson.com.br
      VIRTUAL_PORT: 3000
      LETSENCRYPT_HOST: braza.lurdisson.com.br
    volumes:
      - ./backend/uploads:/app/uploads
    networks:
      - n8nstack_proxy
      - n8nstack_internal
    expose:
      - "3000"

networks:
  n8nstack_proxy:
    external: true
  n8nstack_internal:
    external: true
