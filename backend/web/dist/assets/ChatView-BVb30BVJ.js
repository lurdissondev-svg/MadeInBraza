import{d as R,c as g,R as Y,r as p,a as r,n as U,e as m,b as e,t as k,C as F,i as P,T as Z,J as N,F as K,w as O,v as G,K as q,j as _,o as n,G as J,u as ee,L as se,l as te,y as ne,k as ae,M as re,N as le,E as H,f as c,s as oe,O as ie,m as de}from"./index-B69Psu8I.js";const ue={key:0,class:"flex-shrink-0"},ce=["src"],me={key:1,class:"text-sm font-bold text-white"},fe={class:"flex items-center gap-2 px-1 mb-1"},ge={key:1,class:"text-xs text-primary-400"},ve={class:"text-xs text-gray-500"},xe={key:2,class:"text-xs text-gray-500 italic"},he={key:3,class:"relative ml-auto"},be={key:0,class:"absolute right-0 mt-1 w-32 bg-dark-600 border border-dark-500 rounded-lg shadow-lg z-10"},ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ye=["src","alt"],pe={key:1,class:"relative rounded-xl overflow-hidden bg-dark-700"},we=["src"],Ce=["href"],Me={class:"truncate"},Ue={key:1,class:"px-3 py-2"},Ee=["onKeydown"],$e=R({__name:"MessageBubble",props:{message:{},isCurrentUser:{type:Boolean},isCurrentUserLeader:{type:Boolean}},emits:["delete","edit"],setup(t,{emit:E}){const a=t,v=E,s=g(()=>a.message.user.role===Y.LEADER),h=g(()=>a.isCurrentUser||a.isCurrentUserLeader),w=g(()=>a.isCurrentUser),C=g(()=>h.value||w.value),b=p(!1),d=p(""),i=p(!1),f=p(!1);function M(){d.value=a.message.content||"",b.value=!0,i.value=!1}function j(){b.value=!1,d.value=""}function S(){d.value.trim()&&v("edit",a.message.id,d.value.trim()),b.value=!1}function T(){i.value=!1,f.value=!0}function A(){v("delete",a.message.id),f.value=!1}function z(){f.value=!1}const I=p(!1),$=g(()=>{if(I.value)return null;const x=a.message.user.avatarUrl;return x?`${x}`:null});function V(){I.value=!0}const u=g(()=>a.isCurrentUser?"#9c27b0":s.value?"rgba(156, 39, 176, 0.2)":"#374151"),l=g(()=>a.isCurrentUser?"#ffffff":s.value?"#f3f4f6":"#e5e7eb"),y=g(()=>{if(!a.message.mediaUrl)return!1;if(a.message.mediaType==="image"||a.message.mediaType?.startsWith("image/"))return!0;const x=a.message.mediaUrl.toLowerCase(),o=a.message.fileName?.toLowerCase()||"";return[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"].some(B=>x.includes(B)||o.endsWith(B))}),W=g(()=>{if(!a.message.mediaUrl)return!1;if(a.message.mediaType==="video"||a.message.mediaType?.startsWith("video/"))return!0;const x=a.message.mediaUrl.toLowerCase(),o=a.message.fileName?.toLowerCase()||"";return[".mp4",".webm",".ogg",".mov",".avi"].some(B=>x.includes(B)||o.endsWith(B))});function Q(x){try{return new Date(x).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch{return""}}function L(x){return`${x}`}function X(){a.message.mediaUrl&&window.open(L(a.message.mediaUrl),"_blank")}return(x,o)=>(n(),r("div",{class:U(["flex gap-2",t.isCurrentUser?"flex-row-reverse":"flex-row"])},[t.isCurrentUser?m("",!0):(n(),r("div",ue,[e("div",{class:U(["w-10 h-10 rounded-full flex items-center justify-center overflow-hidden",$.value?"":"bg-dark-500"])},[$.value?(n(),r("img",{key:0,src:$.value,alt:"Avatar",loading:"lazy",decoding:"async",class:"w-full h-full object-cover",onError:V},null,40,ce)):(n(),r("span",me,k(t.message.user.nick.charAt(0).toUpperCase()),1))],2)])),e("div",{class:U(["flex flex-col",t.isCurrentUser?"items-end":"items-start"])},[e("div",fe,[t.isCurrentUser?m("",!0):(n(),r("span",{key:0,class:U(["text-sm font-semibold",s.value?"text-primary-400":"text-gray-300"])},k(t.message.user.nick),3)),!t.isCurrentUser&&s.value?(n(),r("span",ge," [LIDER] ")):m("",!0),e("span",ve,k(Q(t.message.createdAt)),1),t.message.editedAt?(n(),r("span",xe," (editado) ")):m("",!0),C.value&&!b.value?(n(),r("div",he,[e("button",{onClick:o[0]||(o[0]=D=>i.value=!i.value),class:"p-1 hover:bg-dark-500 rounded transition-colors"},[...o[2]||(o[2]=[e("svg",{class:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])]),i.value?(n(),r("div",be,[w.value&&t.message.content?(n(),r("button",{key:0,onClick:M,class:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-dark-500 flex items-center gap-2"},[...o[3]||(o[3]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),P(" Editar ",-1)])])):m("",!0),h.value?(n(),r("button",{key:1,onClick:T,class:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-dark-500 flex items-center gap-2"},[...o[4]||(o[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),P(" Excluir ",-1)])])):m("",!0)])):m("",!0)])):m("",!0)]),(n(),F(Z,{to:"body"},[f.value?(n(),r("div",ke,[e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:z}),e("div",{class:"relative bg-dark-700 border border-dark-500 rounded-2xl p-6 max-w-sm w-full shadow-2xl"},[o[5]||(o[5]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])])],-1)),o[6]||(o[6]=e("h3",{class:"text-lg font-semibold text-gray-100 text-center mb-2"}," Excluir mensagem ",-1)),o[7]||(o[7]=e("p",{class:"text-gray-400 text-center text-sm mb-6"}," Tem certeza que deseja excluir esta mensagem? Esta ação não pode ser desfeita. ",-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:z,class:"flex-1 px-4 py-2.5 bg-dark-600 hover:bg-dark-500 text-gray-300 rounded-xl font-medium transition-colors"}," Cancelar "),e("button",{onClick:A,class:"flex-1 px-4 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-xl font-medium transition-colors"}," Excluir ")])])])):m("",!0)])),e("div",{class:U(["max-w-[280px] rounded-2xl overflow-hidden",[t.isCurrentUser?"rounded-tr-sm":"rounded-tl-sm",t.message.mediaUrl?"p-1":"px-4 py-2"]]),style:N({backgroundColor:u.value,color:l.value})},[t.message.mediaUrl?(n(),r(K,{key:0},[y.value?(n(),r("div",{key:0,class:"rounded-xl overflow-hidden cursor-pointer",onClick:X},[e("img",{src:L(t.message.mediaUrl),alt:t.message.fileName||"Imagem",class:"max-h-72 w-full object-contain bg-dark-700 hover:opacity-90 transition-opacity"},null,8,ye)])):W.value?(n(),r("div",pe,[e("video",{src:L(t.message.mediaUrl),class:"max-h-72 w-full",controls:""},null,8,we)])):(n(),r("a",{key:2,href:L(t.message.mediaUrl),target:"_blank",class:"flex items-center gap-2 px-3 py-2 text-sm hover:opacity-80",style:N({color:l.value})},[o[8]||(o[8]=e("svg",{class:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",Me,k(t.message.fileName||"Arquivo"),1)],12,Ce)),(y.value||W.value)&&t.message.fileName?(n(),r("p",{key:3,class:"text-xs px-2 py-1 opacity-70 truncate",style:N({color:l.value})},k(t.message.fileName),5)):m("",!0)],64)):m("",!0),b.value?(n(),r("div",Ue,[O(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=D=>d.value=D),class:"w-full bg-dark-700 border border-dark-500 rounded-lg px-3 py-2 text-sm text-white resize-none focus:outline-none focus:border-primary-500",rows:"2",onKeydown:[q(_(S,["exact","prevent"]),["enter"]),q(j,["escape"])]},null,40,Ee),[[G,d.value]]),e("div",{class:"flex gap-2 mt-2"},[e("button",{onClick:S,class:"px-3 py-1 text-xs bg-primary-500 text-white rounded hover:bg-primary-600 transition-colors"}," Salvar "),e("button",{onClick:j,class:"px-3 py-1 text-xs bg-dark-500 text-gray-300 rounded hover:bg-dark-400 transition-colors"}," Cancelar ")])])):t.message.content?(n(),r("p",{key:2,class:U(["whitespace-pre-wrap break-words",t.message.mediaUrl?"px-3 py-2":""]),style:N({color:l.value})},k(t.message.content),7)):m("",!0)],6)],2)],2))}}),Be={class:"flex items-end gap-2 p-3 bg-dark-800 border-t border-dark-600"},je=["disabled"],Se={class:"flex-1"},ze=["disabled"],Ie=["disabled"],Le={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},De=R({__name:"MessageInput",props:{disabled:{type:Boolean},sending:{type:Boolean},uploading:{type:Boolean}},emits:["send","sendMedia"],setup(t,{emit:E}){const a=E,v=p(""),s=p(null);function h(){const d=v.value.trim();d&&(a("send",d),v.value="")}function w(d){d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),h())}function C(){s.value?.click()}function b(d){const i=d.target,f=i.files?.[0];f&&(a("sendMedia",f),i.value="")}return(d,i)=>(n(),r("div",Be,[e("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/*,video/*",class:"hidden",onChange:b},null,544),e("button",{onClick:C,disabled:t.disabled||t.sending||t.uploading,class:"p-2 rounded-full hover:bg-dark-600 transition-colors disabled:opacity-50"},[...i[1]||(i[1]=[e("svg",{class:"w-6 h-6 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,je),e("div",Se,[O(e("textarea",{"onUpdate:modelValue":i[0]||(i[0]=f=>v.value=f),onKeydown:w,disabled:t.disabled||t.sending||t.uploading,placeholder:"Digite sua mensagem...",rows:"1",class:"w-full px-4 py-2 bg-dark-600 border border-dark-500 rounded-3xl text-gray-100 placeholder-gray-500 resize-none focus:outline-none focus:border-primary-500 disabled:opacity-50"},null,40,ze),[[G,v.value]])]),e("button",{onClick:h,disabled:!v.value.trim()||t.disabled||t.sending||t.uploading,class:"p-2 rounded-full bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:hover:bg-primary-500"},[t.sending||t.uploading?(n(),F(J,{key:0,size:"sm"})):(n(),r("svg",Le,[...i[2]||(i[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,Ie)]))}}),Ne={class:"h-screen flex flex-col bg-dark-800"},Te={class:"bg-dark-700 border-b border-dark-600 px-4 py-3 flex items-center gap-3 shrink-0"},Ae={class:"flex-1 font-semibold text-gray-100 truncate"},Ve={key:0,class:"flex justify-center py-12"},He={key:1,class:"flex items-center justify-center h-full"},Ke={key:0,class:"flex items-center gap-3 my-4"},Re={class:"text-red-400 text-sm font-medium px-3 py-1 bg-red-500/10 rounded-full"},Fe={key:0,class:"fixed bottom-20 left-4 right-4 bg-red-500/90 text-white px-4 py-3 rounded-lg flex items-center justify-between"},Pe=R({__name:"ChatView",setup(t){const E=te(),a=ae(),v=ee(),s=se(),h=p(null),w=p(!1);let C=null;const b=g(()=>E.params.id),d=g(()=>v.user?.id),i=g(()=>s.firstUnreadMessageId),f=g(()=>{if(!i.value)return 0;const u=s.messages.findIndex(l=>l.id===i.value);return u===-1?0:s.messages.length-u});ne(async()=>{if(b.value){s.channels.length===0&&await s.fetchChannels();const u=s.channels.find(l=>l.id===b.value);u?(await s.openChannel(u),M(),j()):a.push("/channels")}}),re(()=>{S(),s.closeChannel()}),le(()=>s.messages.length,()=>{de(()=>M())});function M(){h.value&&(h.value.scrollTop=h.value.scrollHeight)}function j(){C=setInterval(()=>{s.currentChannel&&s.fetchMessages()},1e4)}function S(){C&&(clearInterval(C),C=null)}async function T(u){await s.sendMessage(u)&&M()}async function A(u){await s.sendMediaMessage(u)&&M()}function z(){s.fetchMembers(),w.value=!0}function I(){a.push("/channels")}async function $(u){await s.deleteMessage(u)}async function V(u,l){await s.editMessage(u,l)}return(u,l)=>(n(),r("div",Ne,[e("header",Te,[e("button",{onClick:I,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...l[2]||(l[2]=[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("h1",Ae,k(c(s).currentChannel?.name||"Chat"),1),e("button",{onClick:z,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...l[3]||(l[3]=[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)])])]),e("div",{ref_key:"messagesContainer",ref:h,class:"flex-1 overflow-y-auto p-4 space-y-4"},[c(s).loadingMessages&&c(s).messages.length===0?(n(),r("div",Ve,[H(J)])):c(s).messages.length===0?(n(),r("div",He,[...l[4]||(l[4]=[e("p",{class:"text-gray-400"},"Nenhuma mensagem ainda. Seja o primeiro a enviar!",-1)])])):(n(!0),r(K,{key:2},oe(c(s).messages,y=>(n(),r(K,{key:y.id},[y.id===i.value&&f.value>0?(n(),r("div",Ke,[l[5]||(l[5]=e("div",{class:"flex-1 h-px bg-red-500/50"},null,-1)),e("span",Re,k(f.value)+" "+k(f.value===1?"mensagem não lida":"mensagens não lidas"),1),l[6]||(l[6]=e("div",{class:"flex-1 h-px bg-red-500/50"},null,-1))])):m("",!0),H($e,{message:y,"is-current-user":y.user.id===d.value,"is-current-user-leader":c(v).isLeader,onDelete:$,onEdit:V},null,8,["message","is-current-user","is-current-user-leader"])],64))),128))],512),H(De,{disabled:!c(s).currentChannel,sending:c(s).sending,uploading:c(s).uploading,onSend:T,onSendMedia:A},null,8,["disabled","sending","uploading"]),c(s).error?(n(),r("div",Fe,[e("span",null,k(c(s).error),1),e("button",{onClick:l[0]||(l[0]=y=>c(s).clearError()),class:"ml-4 font-bold"},"OK")])):m("",!0),w.value&&c(s).currentChannel?(n(),F(ie,{key:1,"channel-name":c(s).currentChannel.name,members:c(s).members,loading:c(s).loadingMembers,onClose:l[1]||(l[1]=y=>w.value=!1)},null,8,["channel-name","members","loading"])):m("",!0)]))}});export{Pe as default};
