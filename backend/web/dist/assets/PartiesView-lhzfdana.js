import{q as C,s as A,r as w,d as z,c as S,a as v,o as c,b as e,e as _,t as g,H as F,n as M,F as T,m as U,i as N,g as f,E as q,x as J,y as j,T as R,z as V,B as K,A as H,w as O,f as D,v as G,u as Q,C as W}from"./index-CZitzd5D.js";import{_ as X}from"./MainLayout.vue_vue_type_script_setup_true_lang-BGXrfI_D.js";import{_ as I}from"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CUL6qR6H.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={async getGlobalParties(){return(await C.get("/parties")).data.parties},async getPartiesByEvent(r){return(await C.get(`/parties/event/${r}`)).data.parties},async createGlobalParty(r){return(await C.post("/parties",r)).data.party},async createEventParty(r,l){return(await C.post(`/parties/event/${r}`,l)).data.party},async deleteParty(r){await C.delete(`/parties/${r}`)},async joinParty(r){return(await C.post(`/parties/${r}/join`)).data.party},async leaveParty(r){return(await C.post(`/parties/${r}/leave`)).data.party}},L=A("parties",()=>{const r=w([]),l=w(new Map),a=w(!1),n=w(null);async function p(){a.value=!0,n.value=null;try{return r.value=await $.getGlobalParties(),!0}catch(t){return n.value=t instanceof Error?t.message:"Erro ao carregar parties",!1}finally{a.value=!1}}async function y(t){a.value=!0,n.value=null;try{const s=await $.getPartiesByEvent(t);return l.value.set(t,s),!0}catch(s){return n.value=s instanceof Error?s.message:"Erro ao carregar parties do evento",!1}finally{a.value=!1}}async function b(t){a.value=!0,n.value=null;try{const s=await $.createGlobalParty(t);return r.value.unshift(s),!0}catch(s){return n.value=s instanceof Error?s.message:"Erro ao criar party",!1}finally{a.value=!1}}async function m(t,s){a.value=!0,n.value=null;try{const i=await $.createEventParty(t,s),h=l.value.get(t)||[];return h.unshift(i),l.value.set(t,h),!0}catch(i){return n.value=i instanceof Error?i.message:"Erro ao criar party",!1}finally{a.value=!1}}async function u(t,s){a.value=!0,n.value=null;try{if(await $.deleteParty(t),r.value=r.value.filter(i=>i.id!==t),s){const i=l.value.get(s)||[];l.value.set(s,i.filter(h=>h.id!==t))}return!0}catch(i){return n.value=i instanceof Error?i.message:"Erro ao deletar party",!1}finally{a.value=!1}}async function o(t,s){n.value=null;try{const i=await $.joinParty(t),h=r.value.findIndex(x=>x.id===t);if(h!==-1&&(r.value[h]=i),s){const x=l.value.get(s)||[],E=x.findIndex(B=>B.id===t);E!==-1&&(x[E]=i,l.value.set(s,[...x]))}return!0}catch(i){return n.value=i instanceof Error?i.message:"Erro ao entrar na party",!1}}async function d(t,s){n.value=null;try{const i=await $.leaveParty(t),h=r.value.findIndex(x=>x.id===t);if(h!==-1&&(r.value[h]=i),s){const x=l.value.get(s)||[],E=x.findIndex(B=>B.id===t);E!==-1&&(x[E]=i,l.value.set(s,[...x]))}return!0}catch(i){return n.value=i instanceof Error?i.message:"Erro ao sair da party",!1}}function k(t){return l.value.get(t)||[]}function P(){n.value=null}return{globalParties:r,eventParties:l,loading:a,error:n,fetchGlobalParties:p,fetchEventParties:y,createGlobalParty:b,createEventParty:m,deleteParty:u,joinParty:o,leaveParty:d,getEventParties:k,clearError:P}}),Z={class:"card flex flex-col"},ee={class:"flex items-start justify-between gap-2 mb-3"},te={class:"min-w-0"},ae={class:"flex items-center gap-2 mb-1"},re={class:"font-semibold text-gray-100 truncate"},se={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-red-500/20 text-red-400"},ne={class:"text-xs text-gray-500"},le={key:0,class:"text-gray-400 text-sm mb-3 line-clamp-2"},oe={class:"mb-3"},ie={class:"flex items-center justify-between text-xs text-gray-400 mb-1"},ue={class:"h-2 bg-dark-600 rounded-full overflow-hidden"},de={key:1,class:"flex flex-wrap gap-1 mb-3"},ce={key:0,class:"ml-1 text-gray-500"},ve=["disabled"],ye=z({__name:"PartyCard",props:{party:{},currentUserId:{},canDelete:{type:Boolean}},emits:["join","leave","delete"],setup(r,{emit:l}){const a=r,n=l,p=S(()=>a.currentUserId?a.party.members.some(o=>o.id===a.currentUserId):!1),y=S(()=>a.party.members.length>=a.party.maxMembers),b=S(()=>`${a.party.members.length}/${a.party.maxMembers}`);function m(){p.value?n("leave",a.party.id):n("join",a.party.id)}function u(){n("delete",a.party.id)}return(o,d)=>(c(),v("div",Z,[e("div",ee,[e("div",te,[e("div",ae,[e("h4",re,g(r.party.name),1),r.party.isClosed?(c(),v("span",se," Fechada ")):_("",!0)]),e("p",ne,"Por: "+g(r.party.createdBy.nick),1)]),r.canDelete?(c(),v("button",{key:0,onClick:u,class:"p-1.5 text-gray-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors flex-shrink-0",title:"Deletar party"},[...d[0]||(d[0]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):_("",!0)]),r.party.description?(c(),v("p",le,g(r.party.description),1)):_("",!0),e("div",oe,[e("div",ie,[d[1]||(d[1]=e("span",null,"Membros",-1)),e("span",null,g(b.value),1)]),e("div",ue,[e("div",{class:M(["h-full transition-all duration-300",y.value?"bg-red-500":"bg-primary-500"]),style:F({width:`${r.party.members.length/r.party.maxMembers*100}%`})},null,6)])]),r.party.members.length>0?(c(),v("div",de,[(c(!0),v(T,null,U(r.party.members,k=>(c(),v("span",{key:k.id,class:M(["inline-flex items-center px-2 py-0.5 rounded text-xs bg-dark-600 text-gray-300",{"bg-primary-500/20 text-primary-400":k.id===r.currentUserId}])},[N(g(k.nick)+" ",1),k.playerClass?(c(),v("span",ce,g(f(q)[k.playerClass]),1)):_("",!0)],2))),128))])):_("",!0),d[2]||(d[2]=e("div",{class:"flex-1"},null,-1)),e("button",{onClick:m,class:M(["btn w-full text-sm",p.value?"btn-secondary":"btn-primary"]),disabled:!p.value&&(y.value||r.party.isClosed)},g(p.value?"Sair da Party":y.value?"Party Lotada":"Entrar"),11,ve)]))}}),pe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},me={class:"relative bg-dark-700 rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-auto"},fe={key:0,class:"p-3 rounded-lg bg-red-900/20 border border-red-500/30 text-red-400 text-sm"},be=["disabled"],xe=["disabled"],ge={class:"flex items-center gap-3"},he=["disabled"],we={class:"text-gray-100 font-medium w-6 text-center"},ke={class:"flex gap-3 pt-2"},Pe=["disabled"],_e=["disabled"],Ce=z({__name:"CreatePartyModal",props:{show:{type:Boolean},eventId:{}},emits:["update:show"],setup(r,{emit:l}){const a=r,n=l,p=L(),y=w(""),b=w(""),m=w(5),u=w(!1),o=w(null);J(()=>a.show,P=>{P&&(y.value="",b.value="",m.value=5,o.value=null)});function d(){n("update:show",!1)}async function k(){if(!y.value.trim()){o.value="Digite um nome para a party";return}u.value=!0,o.value=null;try{let P;a.eventId?P=await p.createEventParty(a.eventId,{name:y.value.trim(),description:b.value.trim()||null,maxMembers:m.value}):P=await p.createGlobalParty({name:y.value.trim(),description:b.value.trim()||null,maxMembers:m.value}),P?d():o.value=p.error||"Erro ao criar party"}catch{o.value="Erro ao criar party"}finally{u.value=!1}}return(P,t)=>(c(),j(R,{to:"body"},[V(K,{name:"modal"},{default:H(()=>[r.show?(c(),v("div",pe,[e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:d}),e("div",me,[e("div",{class:"flex items-center justify-between p-4 border-b border-dark-600"},[t[4]||(t[4]=e("h2",{class:"text-lg font-semibold text-gray-100"},"Nova Party",-1)),e("button",{onClick:d,class:"p-1 text-gray-400 hover:text-gray-200 rounded-lg hover:bg-dark-600 transition-colors"},[...t[3]||(t[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:O(k,["prevent"]),class:"p-4 space-y-4"},[o.value?(c(),v("div",fe,g(o.value),1)):_("",!0),e("div",null,[t[5]||(t[5]=e("label",{for:"name",class:"label"},"Nome da Party *",-1)),D(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),type:"text",class:"input",placeholder:"Ex: Party de Farm",disabled:u.value,maxlength:"50"},null,8,be),[[G,y.value]])]),e("div",null,[t[6]||(t[6]=e("label",{for:"description",class:"label"},"Descrição",-1)),D(e("textarea",{id:"description","onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),class:"input min-h-[80px] resize-none",placeholder:"Descrição opcional...",disabled:u.value,maxlength:"200"},null,8,xe),[[G,b.value]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"maxMembers",class:"label"},"Máximo de Membros",-1)),e("div",ge,[D(e("input",{id:"maxMembers","onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),type:"range",class:"flex-1 h-2 bg-dark-600 rounded-lg appearance-none cursor-pointer accent-primary-500",min:"2",max:"10",disabled:u.value},null,8,he),[[G,m.value,void 0,{number:!0}]]),e("span",we,g(m.value),1)])]),e("div",ke,[e("button",{type:"button",onClick:d,class:"btn btn-secondary flex-1",disabled:u.value}," Cancelar ",8,Pe),e("button",{type:"submit",class:"btn btn-primary flex-1",disabled:u.value||!y.value.trim()},[u.value?(c(),j(I,{key:0,size:"sm",class:"mr-2"})):_("",!0),N(" "+g(u.value?"Criando...":"Criar Party"),1)],8,_e)])],32)])])):_("",!0)]),_:1})]))}}),$e=Y(Ce,[["__scopeId","data-v-7c77426b"]]),Ee={class:"space-y-6"},Me={class:"flex items-center justify-between"},je={class:"flex items-center gap-2"},Be=["disabled"],Se={key:0,class:"flex justify-center py-8"},De={key:1,class:"card bg-red-900/20 border border-red-500/30"},Ge={class:"text-red-400 text-center"},Ve={key:2,class:"card text-center py-8"},ze={key:3,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ie=z({__name:"PartiesView",setup(r){const l=Q(),a=L(),n=w(!1);W(()=>{a.fetchGlobalParties()});function p(){a.fetchGlobalParties()}async function y(u){confirm("Tem certeza que deseja deletar esta party?")&&await a.deleteParty(u)}async function b(u){await a.joinParty(u)}async function m(u){await a.leaveParty(u)}return(u,o)=>(c(),j(X,null,{default:H(()=>[e("div",Ee,[e("div",Me,[e("div",je,[e("button",{onClick:p,class:"p-2 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-dark-600 transition-colors",disabled:f(a).loading},[(c(),v("svg",{class:M(["w-5 h-5",{"animate-spin":f(a).loading}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[2]||(o[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],8,Be)]),e("button",{onClick:o[0]||(o[0]=d=>n.value=!0),class:"btn btn-primary text-sm"},[...o[3]||(o[3]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),N(" Nova Party ",-1)])])]),f(a).loading&&f(a).globalParties.length===0?(c(),v("div",Se,[V(I)])):f(a).error?(c(),v("div",De,[e("p",Ge,g(f(a).error),1),e("button",{onClick:p,class:"btn btn-secondary mt-3 mx-auto block"}," Tentar novamente ")])):f(a).globalParties.length===0?(c(),v("div",Ve,[...o[4]||(o[4]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("p",{class:"text-gray-400"},"Nenhuma party disponível",-1),e("p",{class:"text-gray-500 text-sm mt-1"},"Crie uma party para começar!",-1)])])):(c(),v("div",ze,[(c(!0),v(T,null,U(f(a).globalParties,d=>(c(),j(ye,{key:d.id,party:d,"current-user-id":f(l).user?.id,"can-delete":f(l).isLeader||d.createdBy.id===f(l).user?.id,onJoin:b,onLeave:m,onDelete:y},null,8,["party","current-user-id","can-delete"]))),128))]))]),V($e,{show:n.value,"onUpdate:show":o[1]||(o[1]=d=>n.value=d)},null,8,["show"])]),_:1}))}});export{Ie as default};
