import{d as j,c as b,R as D,a as r,n as C,e as y,b as t,t as k,K as M,F as N,o as n,r as $,w as z,v as V,C as S,H as E,u as R,L as A,l as F,I as H,k as K,M as W,B as P,D as I,f as d,s as q,N as O,m as G}from"./index-B9jUeESS.js";const J={key:0,class:"flex-shrink-0"},Q=["src"],X={key:1,class:"text-sm font-bold text-white"},Y={class:"flex items-center gap-2 px-1 mb-1"},Z={key:1,class:"text-xs text-primary-400"},_={class:"text-xs text-gray-500"},ee=["src","alt"],se={key:1,class:"relative rounded-xl overflow-hidden bg-dark-700"},te=["src"],ne=["href"],ae={class:"truncate"},re=j({__name:"MessageBubble",props:{message:{},isCurrentUser:{type:Boolean}},setup(e){const a=e,m=b(()=>a.message.user.role===D.LEADER),g=b(()=>{const l=a.message.user.avatarUrl;return l?`${l}`:null}),s=b(()=>a.isCurrentUser?"#9c27b0":m.value?"rgba(156, 39, 176, 0.2)":"#374151"),c=b(()=>a.isCurrentUser?"#ffffff":m.value?"#f3f4f6":"#e5e7eb"),v=b(()=>{if(!a.message.mediaUrl)return!1;if(a.message.mediaType==="image"||a.message.mediaType?.startsWith("image/"))return!0;const l=a.message.mediaUrl.toLowerCase(),f=a.message.fileName?.toLowerCase()||"";return[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"].some(x=>l.includes(x)||f.endsWith(x))}),h=b(()=>{if(!a.message.mediaUrl)return!1;if(a.message.mediaType==="video"||a.message.mediaType?.startsWith("video/"))return!0;const l=a.message.mediaUrl.toLowerCase(),f=a.message.fileName?.toLowerCase()||"";return[".mp4",".webm",".ogg",".mov",".avi"].some(x=>l.includes(x)||f.endsWith(x))});function w(l){try{return new Date(l).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch{return""}}function o(l){return`${l}`}function i(){a.message.mediaUrl&&window.open(o(a.message.mediaUrl),"_blank")}return(l,f)=>(n(),r("div",{class:C(["flex gap-2",e.isCurrentUser?"flex-row-reverse":"flex-row"])},[e.isCurrentUser?y("",!0):(n(),r("div",J,[t("div",{class:C(["w-8 h-8 rounded-full flex items-center justify-center overflow-hidden",g.value?"":m.value?"bg-primary-500":"bg-dark-500"])},[g.value?(n(),r("img",{key:0,src:g.value,alt:"Avatar",class:"w-full h-full object-cover"},null,8,Q)):(n(),r("span",X,k(e.message.user.nick.charAt(0).toUpperCase()),1))],2)])),t("div",{class:C(["flex flex-col",e.isCurrentUser?"items-end":"items-start"])},[t("div",Y,[e.isCurrentUser?y("",!0):(n(),r("span",{key:0,class:C(["text-sm font-semibold",m.value?"text-primary-400":"text-gray-300"])},k(e.message.user.nick),3)),!e.isCurrentUser&&m.value?(n(),r("span",Z," [LIDER] ")):y("",!0),t("span",_,k(w(e.message.createdAt)),1)]),t("div",{class:C(["max-w-[280px] rounded-2xl overflow-hidden",[e.isCurrentUser?"rounded-tr-sm":"rounded-tl-sm",e.message.mediaUrl?"p-1":"px-4 py-2"]]),style:M({backgroundColor:s.value,color:c.value})},[e.message.mediaUrl?(n(),r(N,{key:0},[v.value?(n(),r("div",{key:0,class:"rounded-xl overflow-hidden cursor-pointer",onClick:i},[t("img",{src:o(e.message.mediaUrl),alt:e.message.fileName||"Imagem",class:"max-h-72 w-full object-contain bg-dark-700 hover:opacity-90 transition-opacity"},null,8,ee)])):h.value?(n(),r("div",se,[t("video",{src:o(e.message.mediaUrl),class:"max-h-72 w-full",controls:""},null,8,te)])):(n(),r("a",{key:2,href:o(e.message.mediaUrl),target:"_blank",class:"flex items-center gap-2 px-3 py-2 text-sm hover:opacity-80",style:M({color:c.value})},[f[0]||(f[0]=t("svg",{class:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("span",ae,k(e.message.fileName||"Arquivo"),1)],12,ne)),(v.value||h.value)&&e.message.fileName?(n(),r("p",{key:3,class:"text-xs px-2 py-1 opacity-70 truncate",style:M({color:c.value})},k(e.message.fileName),5)):y("",!0)],64)):y("",!0),e.message.content?(n(),r("p",{key:1,class:C(["whitespace-pre-wrap break-words",e.message.mediaUrl?"px-3 py-2":""]),style:M({color:c.value})},k(e.message.content),7)):y("",!0)],6)],2)],2))}}),le={class:"flex items-end gap-2 p-3 bg-dark-800 border-t border-dark-600"},oe=["disabled"],ie={class:"flex-1"},de=["disabled"],ue=["disabled"],ce={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me=j({__name:"MessageInput",props:{disabled:{type:Boolean},sending:{type:Boolean},uploading:{type:Boolean}},emits:["send","sendMedia"],setup(e,{emit:a}){const m=a,g=$(""),s=$(null);function c(){const o=g.value.trim();o&&(m("send",o),g.value="")}function v(o){o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),c())}function h(){s.value?.click()}function w(o){const i=o.target,l=i.files?.[0];l&&(m("sendMedia",l),i.value="")}return(o,i)=>(n(),r("div",le,[t("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/*,video/*",class:"hidden",onChange:w},null,544),t("button",{onClick:h,disabled:e.disabled||e.sending||e.uploading,class:"p-2 rounded-full hover:bg-dark-600 transition-colors disabled:opacity-50"},[...i[1]||(i[1]=[t("svg",{class:"w-6 h-6 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,oe),t("div",ie,[z(t("textarea",{"onUpdate:modelValue":i[0]||(i[0]=l=>g.value=l),onKeydown:v,disabled:e.disabled||e.sending||e.uploading,placeholder:"Digite sua mensagem...",rows:"1",class:"w-full px-4 py-2 bg-dark-600 border border-dark-500 rounded-3xl text-gray-100 placeholder-gray-500 resize-none focus:outline-none focus:border-primary-500 disabled:opacity-50"},null,40,de),[[V,g.value]])]),t("button",{onClick:c,disabled:!g.value.trim()||e.disabled||e.sending||e.uploading,class:"p-2 rounded-full bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:hover:bg-primary-500"},[e.sending||e.uploading?(n(),S(E,{key:0,size:"sm"})):(n(),r("svg",ce,[...i[2]||(i[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,ue)]))}}),ge={class:"h-screen flex flex-col bg-dark-800"},fe={class:"bg-dark-700 border-b border-dark-600 px-4 py-3 flex items-center gap-3 shrink-0"},he={class:"flex-1 font-semibold text-gray-100 truncate"},ve={key:0,class:"flex justify-center py-12"},be={key:1,class:"flex items-center justify-center h-full"},ye={key:0,class:"fixed bottom-20 left-4 right-4 bg-red-500/90 text-white px-4 py-3 rounded-lg flex items-center justify-between"},xe=j({__name:"ChatView",setup(e){const a=F(),m=K(),g=R(),s=A(),c=$(null),v=$(!1);let h=null;const w=b(()=>a.params.id),o=b(()=>g.user?.id);H(async()=>{if(w.value){s.channels.length===0&&await s.fetchChannels();const p=s.channels.find(u=>u.id===w.value);p?(await s.openChannel(p),i(),l()):m.push("/channels")}}),W(()=>{f(),s.closeChannel()}),P(()=>s.messages.length,()=>{G(()=>i())});function i(){c.value&&(c.value.scrollTop=c.value.scrollHeight)}function l(){h=setInterval(()=>{s.currentChannel&&s.fetchMessages()},1e4)}function f(){h&&(clearInterval(h),h=null)}async function B(p){await s.sendMessage(p)&&i()}async function x(p){await s.sendMediaMessage(p)&&i()}function L(){s.fetchMembers(),v.value=!0}function T(){m.push("/channels")}return(p,u)=>(n(),r("div",ge,[t("header",fe,[t("button",{onClick:T,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...u[2]||(u[2]=[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("h1",he,k(d(s).currentChannel?.name||"Chat"),1),t("button",{onClick:L,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...u[3]||(u[3]=[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)])])]),t("div",{ref_key:"messagesContainer",ref:c,class:"flex-1 overflow-y-auto p-4 space-y-4"},[d(s).loadingMessages&&d(s).messages.length===0?(n(),r("div",ve,[I(E)])):d(s).messages.length===0?(n(),r("div",be,[...u[4]||(u[4]=[t("p",{class:"text-gray-400"},"Nenhuma mensagem ainda. Seja o primeiro a enviar!",-1)])])):(n(!0),r(N,{key:2},q(d(s).messages,U=>(n(),S(re,{key:U.id,message:U,"is-current-user":U.user.id===o.value},null,8,["message","is-current-user"]))),128))],512),I(me,{disabled:!d(s).currentChannel,sending:d(s).sending,uploading:d(s).uploading,onSend:B,onSendMedia:x},null,8,["disabled","sending","uploading"]),d(s).error?(n(),r("div",ye,[t("span",null,k(d(s).error),1),t("button",{onClick:u[0]||(u[0]=U=>d(s).clearError()),class:"ml-4 font-bold"},"OK")])):y("",!0),v.value&&d(s).currentChannel?(n(),S(O,{key:1,"channel-name":d(s).currentChannel.name,members:d(s).members,loading:d(s).loadingMembers,onClose:u[1]||(u[1]=U=>v.value=!1)},null,8,["channel-name","members","loading"])):y("",!0)]))}});export{xe as default};
