import{d as N,c as y,R as z,r as $,a as r,n as U,e as b,b as t,t as k,J as B,F as L,o as n,w as D,v as V,C as E,G as T,u as A,K as R,l as F,y as K,k as H,L as W,M as P,E as I,f as o,s as q,N as G,m as J}from"./index-DPO51asr.js";const O={key:0,class:"flex-shrink-0"},Q=["src"],X={key:1,class:"text-sm font-bold text-white"},Y={class:"flex items-center gap-2 px-1 mb-1"},Z={key:1,class:"text-xs text-primary-400"},_={class:"text-xs text-gray-500"},ee=["src","alt"],se={key:1,class:"relative rounded-xl overflow-hidden bg-dark-700"},te=["src"],ne=["href"],ae={class:"truncate"},re=N({__name:"MessageBubble",props:{message:{},isCurrentUser:{type:Boolean}},setup(e){const a=e,f=y(()=>a.message.user.role===z.LEADER),h=$(!1),s=y(()=>{if(h.value)return null;const u=a.message.user.avatarUrl;return u?`${u}`:null});function v(){h.value=!0}const x=y(()=>a.isCurrentUser?"#9c27b0":f.value?"rgba(156, 39, 176, 0.2)":"#374151"),c=y(()=>a.isCurrentUser?"#ffffff":f.value?"#f3f4f6":"#e5e7eb"),p=y(()=>{if(!a.message.mediaUrl)return!1;if(a.message.mediaType==="image"||a.message.mediaType?.startsWith("image/"))return!0;const u=a.message.mediaUrl.toLowerCase(),g=a.message.fileName?.toLowerCase()||"";return[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"].some(w=>u.includes(w)||g.endsWith(w))}),i=y(()=>{if(!a.message.mediaUrl)return!1;if(a.message.mediaType==="video"||a.message.mediaType?.startsWith("video/"))return!0;const u=a.message.mediaUrl.toLowerCase(),g=a.message.fileName?.toLowerCase()||"";return[".mp4",".webm",".ogg",".mov",".avi"].some(w=>u.includes(w)||g.endsWith(w))});function l(u){try{return new Date(u).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch{return""}}function m(u){return`${u}`}function S(){a.message.mediaUrl&&window.open(m(a.message.mediaUrl),"_blank")}return(u,g)=>(n(),r("div",{class:U(["flex gap-2",e.isCurrentUser?"flex-row-reverse":"flex-row"])},[e.isCurrentUser?b("",!0):(n(),r("div",O,[t("div",{class:U(["w-10 h-10 rounded-full flex items-center justify-center overflow-hidden",s.value?"":"bg-dark-500"])},[s.value?(n(),r("img",{key:0,src:s.value,alt:"Avatar",loading:"lazy",decoding:"async",class:"w-full h-full object-cover",onError:v},null,40,Q)):(n(),r("span",X,k(e.message.user.nick.charAt(0).toUpperCase()),1))],2)])),t("div",{class:U(["flex flex-col",e.isCurrentUser?"items-end":"items-start"])},[t("div",Y,[e.isCurrentUser?b("",!0):(n(),r("span",{key:0,class:U(["text-sm font-semibold",f.value?"text-primary-400":"text-gray-300"])},k(e.message.user.nick),3)),!e.isCurrentUser&&f.value?(n(),r("span",Z," [LIDER] ")):b("",!0),t("span",_,k(l(e.message.createdAt)),1)]),t("div",{class:U(["max-w-[280px] rounded-2xl overflow-hidden",[e.isCurrentUser?"rounded-tr-sm":"rounded-tl-sm",e.message.mediaUrl?"p-1":"px-4 py-2"]]),style:B({backgroundColor:x.value,color:c.value})},[e.message.mediaUrl?(n(),r(L,{key:0},[p.value?(n(),r("div",{key:0,class:"rounded-xl overflow-hidden cursor-pointer",onClick:S},[t("img",{src:m(e.message.mediaUrl),alt:e.message.fileName||"Imagem",class:"max-h-72 w-full object-contain bg-dark-700 hover:opacity-90 transition-opacity"},null,8,ee)])):i.value?(n(),r("div",se,[t("video",{src:m(e.message.mediaUrl),class:"max-h-72 w-full",controls:""},null,8,te)])):(n(),r("a",{key:2,href:m(e.message.mediaUrl),target:"_blank",class:"flex items-center gap-2 px-3 py-2 text-sm hover:opacity-80",style:B({color:c.value})},[g[0]||(g[0]=t("svg",{class:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("span",ae,k(e.message.fileName||"Arquivo"),1)],12,ne)),(p.value||i.value)&&e.message.fileName?(n(),r("p",{key:3,class:"text-xs px-2 py-1 opacity-70 truncate",style:B({color:c.value})},k(e.message.fileName),5)):b("",!0)],64)):b("",!0),e.message.content?(n(),r("p",{key:1,class:U(["whitespace-pre-wrap break-words",e.message.mediaUrl?"px-3 py-2":""]),style:B({color:c.value})},k(e.message.content),7)):b("",!0)],6)],2)],2))}}),le={class:"flex items-end gap-2 p-3 bg-dark-800 border-t border-dark-600"},oe=["disabled"],ie={class:"flex-1"},de=["disabled"],ue=["disabled"],ce={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me=N({__name:"MessageInput",props:{disabled:{type:Boolean},sending:{type:Boolean},uploading:{type:Boolean}},emits:["send","sendMedia"],setup(e,{emit:a}){const f=a,h=$(""),s=$(null);function v(){const i=h.value.trim();i&&(f("send",i),h.value="")}function x(i){i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),v())}function c(){s.value?.click()}function p(i){const l=i.target,m=l.files?.[0];m&&(f("sendMedia",m),l.value="")}return(i,l)=>(n(),r("div",le,[t("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/*,video/*",class:"hidden",onChange:p},null,544),t("button",{onClick:c,disabled:e.disabled||e.sending||e.uploading,class:"p-2 rounded-full hover:bg-dark-600 transition-colors disabled:opacity-50"},[...l[1]||(l[1]=[t("svg",{class:"w-6 h-6 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,oe),t("div",ie,[D(t("textarea",{"onUpdate:modelValue":l[0]||(l[0]=m=>h.value=m),onKeydown:x,disabled:e.disabled||e.sending||e.uploading,placeholder:"Digite sua mensagem...",rows:"1",class:"w-full px-4 py-2 bg-dark-600 border border-dark-500 rounded-3xl text-gray-100 placeholder-gray-500 resize-none focus:outline-none focus:border-primary-500 disabled:opacity-50"},null,40,de),[[V,h.value]])]),t("button",{onClick:v,disabled:!h.value.trim()||e.disabled||e.sending||e.uploading,class:"p-2 rounded-full bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:hover:bg-primary-500"},[e.sending||e.uploading?(n(),E(T,{key:0,size:"sm"})):(n(),r("svg",ce,[...l[2]||(l[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,ue)]))}}),ge={class:"h-screen flex flex-col bg-dark-800"},fe={class:"bg-dark-700 border-b border-dark-600 px-4 py-3 flex items-center gap-3 shrink-0"},he={class:"flex-1 font-semibold text-gray-100 truncate"},ve={key:0,class:"flex justify-center py-12"},ye={key:1,class:"flex items-center justify-center h-full"},be={key:0,class:"fixed bottom-20 left-4 right-4 bg-red-500/90 text-white px-4 py-3 rounded-lg flex items-center justify-between"},xe=N({__name:"ChatView",setup(e){const a=F(),f=H(),h=A(),s=R(),v=$(null),x=$(!1);let c=null;const p=y(()=>a.params.id),i=y(()=>h.user?.id);K(async()=>{if(p.value){s.channels.length===0&&await s.fetchChannels();const C=s.channels.find(d=>d.id===p.value);C?(await s.openChannel(C),l(),m()):f.push("/channels")}}),W(()=>{S(),s.closeChannel()}),P(()=>s.messages.length,()=>{J(()=>l())});function l(){v.value&&(v.value.scrollTop=v.value.scrollHeight)}function m(){c=setInterval(()=>{s.currentChannel&&s.fetchMessages()},1e4)}function S(){c&&(clearInterval(c),c=null)}async function u(C){await s.sendMessage(C)&&l()}async function g(C){await s.sendMediaMessage(C)&&l()}function j(){s.fetchMembers(),x.value=!0}function w(){f.push("/channels")}return(C,d)=>(n(),r("div",ge,[t("header",fe,[t("button",{onClick:w,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...d[2]||(d[2]=[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("h1",he,k(o(s).currentChannel?.name||"Chat"),1),t("button",{onClick:j,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...d[3]||(d[3]=[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)])])]),t("div",{ref_key:"messagesContainer",ref:v,class:"flex-1 overflow-y-auto p-4 space-y-4"},[o(s).loadingMessages&&o(s).messages.length===0?(n(),r("div",ve,[I(T)])):o(s).messages.length===0?(n(),r("div",ye,[...d[4]||(d[4]=[t("p",{class:"text-gray-400"},"Nenhuma mensagem ainda. Seja o primeiro a enviar!",-1)])])):(n(!0),r(L,{key:2},q(o(s).messages,M=>(n(),E(re,{key:M.id,message:M,"is-current-user":M.user.id===i.value},null,8,["message","is-current-user"]))),128))],512),I(me,{disabled:!o(s).currentChannel,sending:o(s).sending,uploading:o(s).uploading,onSend:u,onSendMedia:g},null,8,["disabled","sending","uploading"]),o(s).error?(n(),r("div",be,[t("span",null,k(o(s).error),1),t("button",{onClick:d[0]||(d[0]=M=>o(s).clearError()),class:"ml-4 font-bold"},"OK")])):b("",!0),x.value&&o(s).currentChannel?(n(),E(G,{key:1,"channel-name":o(s).currentChannel.name,members:o(s).members,loading:o(s).loadingMembers,onClose:d[1]||(d[1]=M=>x.value=!1)},null,8,["channel-name","members","loading"])):b("",!0)]))}});export{xe as default};
