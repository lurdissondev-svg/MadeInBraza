import{d as $,c as w,R as N,a as r,o as t,n as p,b as n,e as f,t as v,F as B,r as C,f as R,v as E,y as M,u as L,k as V,C as F,j as K,L as A,x as H,z as U,g as a,m as P,M as O}from"./index-CZitzd5D.js";import{u as q,M as G}from"./MembersSheet-CmJPFIAI.js";import{_ as S}from"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CUL6qR6H.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"flex items-center gap-2 px-1 mb-1"},Q={key:1,class:"text-xs text-primary-400"},W={class:"text-xs text-gray-500"},X={key:0,class:"rounded-xl overflow-hidden"},Y=["src","alt"],Z={key:1,class:"relative rounded-xl overflow-hidden bg-dark-700"},_=["src"],ee={key:2,class:"text-xs px-2 py-1 opacity-70 truncate"},se=$({__name:"MessageBubble",props:{message:{},isCurrentUser:{type:Boolean}},setup(e){const b=e,u=w(()=>b.message.user.role===N.LEADER),m=w(()=>b.isCurrentUser?"bg-primary-500 text-white":u.value?"bg-primary-500/20 text-gray-100":"bg-dark-600 text-gray-200");function s(c){try{return new Date(c).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch{return""}}function d(c){return`${c}`}return(c,g)=>(t(),r("div",{class:p(["flex flex-col",e.isCurrentUser?"items-end":"items-start"])},[n("div",J,[e.isCurrentUser?f("",!0):(t(),r("span",{key:0,class:p(["text-sm font-semibold",u.value?"text-primary-400":"text-gray-300"])},v(e.message.user.nick),3)),!e.isCurrentUser&&u.value?(t(),r("span",Q," [LIDER] ")):f("",!0),n("span",W,v(s(e.message.createdAt)),1)]),n("div",{class:p(["max-w-[280px] rounded-2xl overflow-hidden",[m.value,e.isCurrentUser?"rounded-tr-sm":"rounded-tl-sm",e.message.mediaUrl?"p-1":"px-4 py-2"]])},[e.message.mediaUrl?(t(),r(B,{key:0},[e.message.mediaType==="image"?(t(),r("div",X,[n("img",{src:d(e.message.mediaUrl),alt:e.message.fileName||"Imagem",class:"max-h-72 w-full object-contain bg-dark-700"},null,8,Y)])):e.message.mediaType==="video"?(t(),r("div",Z,[n("video",{src:d(e.message.mediaUrl),class:"max-h-72 w-full",controls:""},null,8,_)])):f("",!0),e.message.fileName?(t(),r("p",ee,v(e.message.fileName),1)):f("",!0)],64)):f("",!0),e.message.content?(t(),r("p",{key:1,class:p(["whitespace-pre-wrap break-words",e.message.mediaUrl?"px-3 py-2":""])},v(e.message.content),3)):f("",!0)],2)],2))}}),ne={class:"flex items-end gap-2 p-3 bg-dark-800 border-t border-dark-600"},te=["disabled"],ae={class:"flex-1"},re=["disabled"],le=["disabled"],oe={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ie=$({__name:"MessageInput",props:{disabled:{type:Boolean},sending:{type:Boolean},uploading:{type:Boolean}},emits:["send","sendMedia"],setup(e,{emit:b}){const u=b,m=C(""),s=C(null);function d(){const i=m.value.trim();i&&(u("send",i),m.value="")}function c(i){i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),d())}function g(){s.value?.click()}function x(i){const l=i.target,y=l.files?.[0];y&&(u("sendMedia",y),l.value="")}return(i,l)=>(t(),r("div",ne,[n("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/*,video/*",class:"hidden",onChange:x},null,544),n("button",{onClick:g,disabled:e.disabled||e.sending||e.uploading,class:"p-2 rounded-full hover:bg-dark-600 transition-colors disabled:opacity-50"},[...l[1]||(l[1]=[n("svg",{class:"w-6 h-6 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,te),n("div",ae,[R(n("textarea",{"onUpdate:modelValue":l[0]||(l[0]=y=>m.value=y),onKeydown:c,disabled:e.disabled||e.sending||e.uploading,placeholder:"Digite sua mensagem...",rows:"1",class:"w-full px-4 py-2 bg-dark-600 border border-dark-500 rounded-3xl text-gray-100 placeholder-gray-500 resize-none focus:outline-none focus:border-primary-500 disabled:opacity-50"},null,40,re),[[E,m.value]])]),n("button",{onClick:d,disabled:!m.value.trim()||e.disabled||e.sending||e.uploading,class:"p-2 rounded-full bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50 disabled:hover:bg-primary-500"},[e.sending||e.uploading?(t(),M(S,{key:0,size:"sm"})):(t(),r("svg",oe,[...l[2]||(l[2]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,le)]))}}),de={class:"h-screen flex flex-col bg-dark-800"},ce={class:"bg-dark-700 border-b border-dark-600 px-4 py-3 flex items-center gap-3 shrink-0"},ue={class:"flex-1 font-semibold text-gray-100 truncate"},me={key:0,class:"flex justify-center py-12"},ge={key:1,class:"flex items-center justify-center h-full"},fe={key:0,class:"fixed bottom-20 left-4 right-4 bg-red-500/90 text-white px-4 py-3 rounded-lg flex items-center justify-between"},ke=$({__name:"ChatView",setup(e){const b=V(),u=K(),m=L(),s=q(),d=C(null),c=C(!1);let g=null;const x=w(()=>b.params.id),i=w(()=>m.user?.id);F(async()=>{if(x.value){s.channels.length===0&&await s.fetchChannels();const h=s.channels.find(o=>o.id===x.value);h?(await s.openChannel(h),l(),y()):u.push("/web/channels")}}),A(()=>{j(),s.closeChannel()}),H(()=>s.messages.length,()=>{O(()=>l())});function l(){d.value&&(d.value.scrollTop=d.value.scrollHeight)}function y(){g=setInterval(()=>{s.currentChannel&&s.fetchMessages()},1e4)}function j(){g&&(clearInterval(g),g=null)}async function I(h){await s.sendMessage(h)&&l()}async function D(h){await s.sendMediaMessage(h)&&l()}function T(){s.fetchMembers(),c.value=!0}function z(){u.push("/web/channels")}return(h,o)=>(t(),r("div",de,[n("header",ce,[n("button",{onClick:z,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...o[2]||(o[2]=[n("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),n("h1",ue,v(a(s).currentChannel?.name||"Chat"),1),n("button",{onClick:T,class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...o[3]||(o[3]=[n("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)])])]),n("div",{ref_key:"messagesContainer",ref:d,class:"flex-1 overflow-y-auto p-4 space-y-4"},[a(s).loadingMessages&&a(s).messages.length===0?(t(),r("div",me,[U(S)])):a(s).messages.length===0?(t(),r("div",ge,[...o[4]||(o[4]=[n("p",{class:"text-gray-400"},"Nenhuma mensagem ainda. Seja o primeiro a enviar!",-1)])])):(t(!0),r(B,{key:2},P(a(s).messages,k=>(t(),M(se,{key:k.id,message:k,"is-current-user":k.user.id===i.value},null,8,["message","is-current-user"]))),128))],512),U(ie,{disabled:!a(s).currentChannel,sending:a(s).sending,uploading:a(s).uploading,onSend:I,onSendMedia:D},null,8,["disabled","sending","uploading"]),a(s).error?(t(),r("div",fe,[n("span",null,v(a(s).error),1),n("button",{onClick:o[0]||(o[0]=k=>a(s).clearError()),class:"ml-4 font-bold"},"OK")])):f("",!0),c.value&&a(s).currentChannel?(t(),M(G,{key:1,"channel-name":a(s).currentChannel.name,members:a(s).members,loading:a(s).loadingMembers,onClose:o[1]||(o[1]=k=>c.value=!1)},null,8,["channel-name","members","loading"])):f("",!0)]))}});export{ke as default};
