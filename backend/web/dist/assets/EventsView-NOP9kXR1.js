import{q as P,s as R,r as y,d as z,c as _,E as A,a as i,o,n as $,b as e,e as k,t as p,i as D,F as B,m as L,g as m,G,x as K,y as S,T as Q,z as U,B as W,A as N,w as X,f as j,v as M,P as Y,u as Z,C as ee}from"./index-CZitzd5D.js";import{_ as te}from"./MainLayout.vue_vue_type_script_setup_true_lang-BGXrfI_D.js";import{_ as H}from"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CUL6qR6H.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={async getEvents(){return(await P.get("/events")).data.events},async createEvent(a){return(await P.post("/events",a)).data.event},async deleteEvent(a){await P.delete(`/events/${a}`)},async joinEvent(a){return(await P.post(`/events/${a}/join`)).data.event},async leaveEvent(a){return(await P.post(`/events/${a}/leave`)).data.event}},q=R("events",()=>{const a=y([]),u=y(!1),s=y(null);async function w(){u.value=!0,s.value=null;try{return a.value=await T.getEvents(),!0}catch(d){return s.value=d instanceof Error?d.message:"Erro ao carregar eventos",!1}finally{u.value=!1}}async function x(d){u.value=!0,s.value=null;try{const t=await T.createEvent(d);return a.value.unshift(t),!0}catch(t){return s.value=t instanceof Error?t.message:"Erro ao criar evento",!1}finally{u.value=!1}}async function v(d){u.value=!0,s.value=null;try{return await T.deleteEvent(d),a.value=a.value.filter(t=>t.id!==d),!0}catch(t){return s.value=t instanceof Error?t.message:"Erro ao deletar evento",!1}finally{u.value=!1}}async function b(d){s.value=null;try{const t=await T.joinEvent(d),n=a.value.findIndex(l=>l.id===d);return n!==-1&&(a.value[n]=t),!0}catch(t){return s.value=t instanceof Error?t.message:"Erro ao entrar no evento",!1}}async function g(d){s.value=null;try{const t=await T.leaveEvent(d),n=a.value.findIndex(l=>l.id===d);return n!==-1&&(a.value[n]=t),!0}catch(t){return s.value=t instanceof Error?t.message:"Erro ao sair do evento",!1}}function h(){s.value=null}return{events:a,loading:u,error:s,fetchEvents:w,createEvent:x,deleteEvent:v,joinEvent:b,leaveEvent:g,clearError:h}}),ne={class:"flex items-start justify-between gap-3"},ae={class:"flex-1 min-w-0"},le={class:"flex items-center gap-2 mb-2"},re={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-500/20 text-gray-400"},oe={key:1,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-500/20 text-red-400"},ie={class:"text-xs text-gray-500"},de={class:"font-semibold text-gray-100 mb-1"},ue={key:0,class:"text-gray-400 text-sm mb-2"},ce={class:"flex flex-wrap gap-3 text-xs text-gray-500"},ve={class:"flex items-center gap-1"},me={class:"flex items-center gap-1"},pe={key:2,class:"mt-2 flex flex-wrap gap-1"},fe={class:"ml-1 text-gray-500"},xe={class:"text-xs text-gray-500 mt-2"},ge={class:"flex flex-col items-end gap-2 flex-shrink-0"},ye=["disabled"],I=z({__name:"EventCard",props:{event:{},currentUserId:{},canDelete:{type:Boolean},isPast:{type:Boolean}},emits:["join","leave","delete"],setup(a,{emit:u}){const s=a,w=u,x=y(!1),v=_(()=>s.currentUserId?s.event.participants.some(l=>l.id===s.currentUserId):!1),b=_(()=>s.event.maxParticipants?s.event.participants.length>=s.event.maxParticipants:!1),g=_(()=>{const l=s.event.participants.length,c=s.event.maxParticipants;return c?`${l}/${c}`:`${l}`}),h=_(()=>new Date(s.event.eventDate).toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})),d=_(()=>!s.event.requiredClasses||s.event.requiredClasses.length===0?"Todas as classes":s.event.requiredClasses.map(l=>A[l]||l).join(", "));function t(){v.value?w("leave",s.event.id):w("join",s.event.id)}function n(){w("delete",s.event.id)}return(l,c)=>(o(),i("div",{class:$(["card",{"opacity-60":a.isPast}])},[e("div",ne,[e("div",ae,[e("div",le,[a.isPast?(o(),i("span",re," Encerrado ")):b.value?(o(),i("span",oe," Lotado ")):k("",!0),e("span",ie,p(h.value),1)]),e("h4",de,p(a.event.title),1),a.event.description?(o(),i("p",ue,p(a.event.description),1)):k("",!0),e("div",ce,[e("span",ve,[c[1]||(c[1]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),D(" "+p(g.value)+" participantes ",1)]),e("span",me,[c[2]||(c[2]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),D(" "+p(d.value),1)])]),a.event.participants.length>0?(o(),i("button",{key:1,onClick:c[0]||(c[0]=C=>x.value=!x.value),class:"mt-2 text-xs text-primary-400 hover:text-primary-300 flex items-center gap-1"},[(o(),i("svg",{class:$(["w-4 h-4 transition-transform",{"rotate-180":x.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...c[3]||(c[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)),D(" "+p(x.value?"Ocultar":"Ver")+" participantes ",1)])):k("",!0),x.value&&a.event.participants.length>0?(o(),i("div",pe,[(o(!0),i(B,null,L(a.event.participants,C=>(o(),i("span",{key:C.id,class:$(["inline-flex items-center px-2 py-0.5 rounded text-xs bg-dark-600 text-gray-300",{"bg-primary-500/20 text-primary-400":C.id===a.currentUserId}])},[D(p(C.nick)+" ",1),e("span",fe,p(m(A)[C.playerClass]),1)],2))),128))])):k("",!0),e("p",xe," Por: "+p(a.event.createdBy.nick),1)]),e("div",ge,[a.canDelete?(o(),i("button",{key:0,onClick:n,class:"p-2 text-gray-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Deletar evento"},[...c[4]||(c[4]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):k("",!0),a.isPast?k("",!0):(o(),i("button",{key:1,onClick:t,class:$(["btn text-sm",v.value?"btn-secondary":"btn-primary"]),disabled:!v.value&&b.value},p(v.value?"Sair":"Participar"),11,ye))])])],2))}}),be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},he={class:"relative bg-dark-700 rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-auto"},ke={key:0,class:"p-3 rounded-lg bg-red-900/20 border border-red-500/30 text-red-400 text-sm"},we=["disabled"],Ee=["disabled"],_e={class:"grid grid-cols-2 gap-3"},Ce=["min","disabled"],$e=["disabled"],De=["disabled"],Pe={class:"flex items-center justify-between mb-2"},je={class:"flex flex-wrap gap-2"},Me=["onClick","disabled"],Te={class:"text-xs text-gray-500 mt-1"},Be={class:"flex gap-3 pt-2"},Se=["disabled"],Ve=["disabled"],Le=z({__name:"CreateEventModal",props:{show:{type:Boolean}},emits:["update:show"],setup(a,{emit:u}){const s=a,w=u,x=q(),v=y(""),b=y(""),g=y(""),h=y(""),d=y(null),t=y([]),n=y(!1),l=y(null),c=Object.values(G),C=_(()=>new Date().toISOString().split("T")[0]);K(()=>s.show,E=>{E&&(v.value="",b.value="",g.value="",h.value="",d.value=null,t.value=[],l.value=null)});function V(){w("update:show",!1)}function O(E){const r=t.value.indexOf(E);r===-1?t.value.push(E):t.value.splice(r,1)}function F(){t.value.length===c.length?t.value=[]:t.value=[...c]}async function J(){if(!v.value.trim()||!g.value||!h.value){l.value="Preencha todos os campos obrigatórios";return}n.value=!0,l.value=null;try{const E=new Date(`${g.value}T${h.value}`);await x.createEvent({title:v.value.trim(),description:b.value.trim()||null,eventDate:E.toISOString(),maxParticipants:d.value||null,requiredClasses:t.value.length>0?t.value:void 0})?V():l.value=x.error||"Erro ao criar evento"}catch{l.value="Erro ao criar evento"}finally{n.value=!1}}return(E,r)=>(o(),S(Q,{to:"body"},[U(W,{name:"modal"},{default:N(()=>[a.show?(o(),i("div",be,[e("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:V}),e("div",he,[e("div",{class:"flex items-center justify-between p-4 border-b border-dark-600"},[r[6]||(r[6]=e("h2",{class:"text-lg font-semibold text-gray-100"},"Novo Evento",-1)),e("button",{onClick:V,class:"p-1 text-gray-400 hover:text-gray-200 rounded-lg hover:bg-dark-600 transition-colors"},[...r[5]||(r[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:X(J,["prevent"]),class:"p-4 space-y-4"},[l.value?(o(),i("div",ke,p(l.value),1)):k("",!0),e("div",null,[r[7]||(r[7]=e("label",{for:"title",class:"label"},"Título *",-1)),j(e("input",{id:"title","onUpdate:modelValue":r[0]||(r[0]=f=>v.value=f),type:"text",class:"input",placeholder:"Nome do evento",disabled:n.value,maxlength:"100"},null,8,we),[[M,v.value]])]),e("div",null,[r[8]||(r[8]=e("label",{for:"description",class:"label"},"Descrição",-1)),j(e("textarea",{id:"description","onUpdate:modelValue":r[1]||(r[1]=f=>b.value=f),class:"input min-h-[80px] resize-none",placeholder:"Descrição opcional...",disabled:n.value,maxlength:"500"},null,8,Ee),[[M,b.value]])]),e("div",_e,[e("div",null,[r[9]||(r[9]=e("label",{for:"date",class:"label"},"Data *",-1)),j(e("input",{id:"date","onUpdate:modelValue":r[2]||(r[2]=f=>g.value=f),type:"date",class:"input",min:C.value,disabled:n.value},null,8,Ce),[[M,g.value]])]),e("div",null,[r[10]||(r[10]=e("label",{for:"time",class:"label"},"Horário *",-1)),j(e("input",{id:"time","onUpdate:modelValue":r[3]||(r[3]=f=>h.value=f),type:"time",class:"input",disabled:n.value},null,8,$e),[[M,h.value]])])]),e("div",null,[r[11]||(r[11]=e("label",{for:"maxParticipants",class:"label"},"Máximo de Participantes",-1)),j(e("input",{id:"maxParticipants","onUpdate:modelValue":r[4]||(r[4]=f=>d.value=f),type:"number",class:"input",placeholder:"Sem limite",min:"1",max:"100",disabled:n.value},null,8,De),[[M,d.value,void 0,{number:!0}]])]),e("div",null,[e("div",Pe,[r[12]||(r[12]=e("label",{class:"label mb-0"},"Classes Permitidas",-1)),e("button",{type:"button",onClick:F,class:"text-xs text-primary-400 hover:text-primary-300"},p(t.value.length===m(c).length?"Desmarcar todas":"Selecionar todas"),1)]),e("div",je,[(o(!0),i(B,null,L(m(c),f=>(o(),i("button",{key:f,type:"button",onClick:Qe=>O(f),class:$(["px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",t.value.includes(f)?"bg-primary-500 text-dark-900":"bg-dark-600 text-gray-300 hover:bg-dark-500"]),disabled:n.value},p(m(Y)[f]),11,Me))),128))]),e("p",Te,p(t.value.length===0?"Todas as classes podem participar":`${t.value.length} classe(s) selecionada(s)`),1)]),e("div",Be,[e("button",{type:"button",onClick:V,class:"btn btn-secondary flex-1",disabled:n.value}," Cancelar ",8,Se),e("button",{type:"submit",class:"btn btn-primary flex-1",disabled:n.value||!v.value.trim()||!g.value||!h.value},[n.value?(o(),S(H,{key:0,size:"sm",class:"mr-2"})):k("",!0),D(" "+p(n.value?"Criando...":"Criar Evento"),1)],8,Ve)])],32)])])):k("",!0)]),_:1})]))}}),Ue=se(Le,[["__scopeId","data-v-f2f03d84"]]),ze={class:"space-y-6"},Ae={class:"flex items-center justify-between"},Ie={class:"flex items-center gap-2"},Ne=["disabled"],He={key:0,class:"flex justify-center py-8"},qe={key:1,class:"card bg-red-900/20 border border-red-500/30"},Oe={class:"text-red-400 text-center"},Fe={key:2,class:"card text-center py-8"},Je={key:0},Re={class:"space-y-3"},Ge={key:1},Ke={class:"space-y-3"},et=z({__name:"EventsView",setup(a){const u=Z(),s=q(),w=y(!1),x=_(()=>{const t=new Date;return s.events.filter(n=>new Date(n.eventDate)>=t).sort((n,l)=>new Date(n.eventDate).getTime()-new Date(l.eventDate).getTime())}),v=_(()=>{const t=new Date;return s.events.filter(n=>new Date(n.eventDate)<t).sort((n,l)=>new Date(l.eventDate).getTime()-new Date(n.eventDate).getTime())});ee(()=>{s.fetchEvents()});function b(){s.fetchEvents()}async function g(t){confirm("Tem certeza que deseja deletar este evento?")&&await s.deleteEvent(t)}async function h(t){await s.joinEvent(t)}async function d(t){await s.leaveEvent(t)}return(t,n)=>(o(),S(te,null,{default:N(()=>[e("div",ze,[e("div",Ae,[e("div",Ie,[e("button",{onClick:b,class:"p-2 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-dark-600 transition-colors",disabled:m(s).loading},[(o(),i("svg",{class:$(["w-5 h-5",{"animate-spin":m(s).loading}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...n[2]||(n[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],8,Ne)]),m(u).isLeader?(o(),i("button",{key:0,onClick:n[0]||(n[0]=l=>w.value=!0),class:"btn btn-primary text-sm"},[...n[3]||(n[3]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),D(" Novo Evento ",-1)])])):k("",!0)]),m(s).loading&&m(s).events.length===0?(o(),i("div",He,[U(H)])):m(s).error?(o(),i("div",qe,[e("p",Oe,p(m(s).error),1),e("button",{onClick:b,class:"btn btn-secondary mt-3 mx-auto block"}," Tentar novamente ")])):m(s).events.length===0?(o(),i("div",Fe,[...n[4]||(n[4]=[e("svg",{class:"w-12 h-12 mx-auto text-gray-500 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("p",{class:"text-gray-400"},"Nenhum evento disponível",-1)])])):(o(),i(B,{key:3},[x.value.length>0?(o(),i("div",Je,[n[5]||(n[5]=e("h3",{class:"text-sm font-medium text-gray-400 uppercase tracking-wide mb-3"},"Próximos Eventos",-1)),e("div",Re,[(o(!0),i(B,null,L(x.value,l=>(o(),S(I,{key:l.id,event:l,"current-user-id":m(u).user?.id,"can-delete":m(u).isLeader,onJoin:h,onLeave:d,onDelete:g},null,8,["event","current-user-id","can-delete"]))),128))])])):k("",!0),v.value.length>0?(o(),i("div",Ge,[n[6]||(n[6]=e("h3",{class:"text-sm font-medium text-gray-400 uppercase tracking-wide mb-3"},"Eventos Passados",-1)),e("div",Ke,[(o(!0),i(B,null,L(v.value,l=>(o(),S(I,{key:l.id,event:l,"current-user-id":m(u).user?.id,"can-delete":m(u).isLeader,"is-past":!0,onDelete:g},null,8,["event","current-user-id","can-delete"]))),128))])])):k("",!0)],64))]),U(Ue,{show:w.value,"onUpdate:show":n[1]||(n[1]=l=>w.value=l)},null,8,["show"])]),_:1}))}});export{et as default};
