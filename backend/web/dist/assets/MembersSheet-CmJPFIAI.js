import{q as d,s as G,r as c,c as F,d as V,a as f,F as L,b as t,t as g,z as U,m as q,o as m,n as w,g as p,R as h,e as P,E as T}from"./index-CZitzd5D.js";import{_ as H}from"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CUL6qR6H.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const v={async getChannels(){return(await d.get("/channels")).data.channels},async setupDefaultChannels(){await d.post("/channels/setup")},async getChannelMessages(a,s=50,r){const u={limit:s};return r&&(u.before=r),(await d.get(`/channels/${a}/messages`,{params:u})).data},async sendMessage(a,s){return(await d.post(`/channels/${a}/messages`,{content:s})).data},async sendMediaMessage(a,s,r){const u=new FormData;return u.append("file",s),r&&u.append("content",r),(await d.post(`/channels/${a}/messages/media`,u,{headers:{"Content-Type":"multipart/form-data"}})).data},async getChannelMembers(a){return(await d.get(`/channels/${a}/members`)).data.members},async markAsRead(a){await d.post(`/channels/${a}/read`)}},ue=G("channels",()=>{const a=c([]),s=c(null),r=c([]),u=c([]),n=c({}),l=c(!1),E=c(!1),x=c(!1),C=c(!1),b=c(!1),o=c(null),_=F(()=>[...a.value].sort((e,i)=>e.type==="LEADERS"&&i.type!=="LEADERS"?-1:i.type==="LEADERS"&&e.type!=="LEADERS"?1:e.type==="GENERAL"&&i.type!=="GENERAL"?-1:i.type==="GENERAL"&&e.type!=="GENERAL"?1:e.name.localeCompare(i.name)));async function M(){l.value=!0,o.value=null;try{return a.value=await v.getChannels(),!0}catch(e){return o.value=e instanceof Error?e.message:"Erro ao carregar canais",!1}finally{l.value=!1}}async function A(){l.value=!0,o.value=null;try{return await v.setupDefaultChannels(),await M(),!0}catch(e){return o.value=e instanceof Error?e.message:"Erro ao criar canais",!1}finally{l.value=!1}}async function R(e){return s.value=e,r.value=[],k()}function D(){s.value=null,r.value=[],u.value=[]}async function k(){if(!s.value)return!1;E.value=!0,o.value=null;try{return r.value=await v.getChannelMessages(s.value.id),await v.markAsRead(s.value.id),n.value[s.value.id]=0,!0}catch(e){return o.value=e instanceof Error?e.message:"Erro ao carregar mensagens",!1}finally{E.value=!1}}async function N(e){if(!s.value||!e.trim())return!1;C.value=!0,o.value=null;try{const i=await v.sendMessage(s.value.id,e);return r.value.push(i),!0}catch(i){return o.value=i instanceof Error?i.message:"Erro ao enviar mensagem",!1}finally{C.value=!1}}async function S(e,i){if(!s.value)return!1;b.value=!0,o.value=null;try{const y=await v.sendMediaMessage(s.value.id,e,i);return r.value.push(y),!0}catch(y){return o.value=y instanceof Error?y.message:"Erro ao enviar mÃ­dia",!1}finally{b.value=!1}}async function $(){if(!s.value)return!1;x.value=!0,o.value=null;try{return u.value=await v.getChannelMembers(s.value.id),!0}catch(e){return o.value=e instanceof Error?e.message:"Erro ao carregar membros",!1}finally{x.value=!1}}function B(e){r.value.find(i=>i.id===e.id)||r.value.push(e)}function z(e){n.value[e]=(n.value[e]||0)+1}function j(){o.value=null}return{channels:a,currentChannel:s,messages:r,members:u,unreadCounts:n,loading:l,loadingMessages:E,loadingMembers:x,sending:C,uploading:b,error:o,sortedChannels:_,fetchChannels:M,setupDefaultChannels:A,openChannel:R,closeChannel:D,fetchMessages:k,sendMessage:N,sendMediaMessage:S,fetchMembers:$,addMessage:B,incrementUnread:z,clearError:j}}),J={class:"fixed inset-x-0 bottom-0 z-50 animate-slide-up"},K={class:"bg-dark-700 rounded-t-2xl max-h-[70vh] overflow-hidden flex flex-col"},O={class:"flex items-center justify-between p-4 border-b border-dark-600"},Q={class:"text-sm text-gray-400"},W={class:"flex-1 overflow-y-auto p-4"},X={key:0,class:"flex justify-center py-8"},Y={key:1,class:"text-center py-8"},Z={key:2,class:"space-y-2"},ee={class:"text-sm text-gray-400 mb-3"},se={class:"flex-1"},ae={class:"flex items-center gap-2"},ne={key:0,class:"w-4 h-4 text-primary-400",fill:"currentColor",viewBox:"0 0 24 24"},te={class:"text-sm text-gray-400"},re=V({__name:"MembersSheet",props:{channelName:{},members:{},loading:{type:Boolean}},emits:["close"],setup(a,{emit:s}){const r=s;return(u,n)=>(m(),f(L,null,[t("div",{class:"fixed inset-0 bg-black/50 z-40",onClick:n[0]||(n[0]=l=>r("close"))}),t("div",J,[t("div",K,[t("div",O,[t("div",null,[n[2]||(n[2]=t("h3",{class:"text-lg font-semibold text-gray-100"},"Membros",-1)),t("p",Q,g(a.channelName),1)]),t("button",{onClick:n[1]||(n[1]=l=>r("close")),class:"p-2 hover:bg-dark-600 rounded-lg transition-colors"},[...n[3]||(n[3]=[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",W,[a.loading?(m(),f("div",X,[U(H)])):a.members.length===0?(m(),f("div",Y,[...n[4]||(n[4]=[t("p",{class:"text-gray-400"},"Nenhum membro encontrado",-1)])])):(m(),f("div",Z,[t("p",ee,g(a.members.length)+" "+g(a.members.length===1?"membro":"membros"),1),(m(!0),f(L,null,q(a.members,l=>(m(),f("div",{key:l.id,class:w(["flex items-center gap-3 p-3 rounded-lg",l.role===p(h).LEADER?"bg-primary-500/10":"bg-dark-600"])},[t("div",{class:w(["w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",l.role===p(h).LEADER?"bg-primary-500":"bg-dark-500"])},g(l.nick.charAt(0).toUpperCase()),3),t("div",se,[t("div",ae,[t("span",{class:w(["font-medium",l.role===p(h).LEADER?"text-primary-400":"text-gray-100"])},g(l.nick),3),l.role===p(h).LEADER?(m(),f("svg",ne,[...n[5]||(n[5]=[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"},null,-1)])])):P("",!0)]),t("span",te,g(p(T)[l.playerClass]),1)])],2))),128))]))])])])],64))}}),ce=I(re,[["__scopeId","data-v-6d9f6111"]]);export{ce as M,ue as u};
